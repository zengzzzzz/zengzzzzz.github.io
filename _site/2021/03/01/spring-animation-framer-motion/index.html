<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>前端弹性动画与 framer-motion 动画库初探</title>
    <meta name="description" content="前端动画的开发一直是我所热衷探索与研究的内容，本文将描述什么是拟真的动画效果，目前所流行的 React 动画库，以及一些基于 framer-motion 动画库的 demos。">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_8v3czwksspqlg14i.css">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://localhost:4000/2021/03/01/spring-animation-framer-motion/">
    <link rel="alternate" type="application/rss+xml" title="HyG" href="http://localhost:4000/feed.xml ">


    <script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?cf8506e0ef223e57ff6239944e5d46a4";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>


    <script>
    // google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-72449510-4', 'auto');
      ga('send', 'pageview');

    </script>



<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    tex2jax: { inlineMath: [["$","$"],["\\(","\\)"]] },
    "HTML-CSS": {
      linebreaks: { automatic: true, width: "container" }
    }
});
</script>
<script type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">HyG</a>
        <small>Front-end Dev Engineer</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/collection/">
                        
                            <i class="fa fa-bookmark"></i>Collections
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/demo/">
                        
                            <i class="fa fa-play"></i>Demos
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-heart"></i>About
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" post>
    <div class="left">
        <h1>前端弹性动画与 framer-motion 动画库初探</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2021-03-01
            </div>

            <div class="label-card">
                <i class="fa fa-user"></i>HyG
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#JavaScript" title="Category: JavaScript" rel="category">JavaScript</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

            <div class="label-card">
            
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <!--a href="/tag/#%E5%8A%A8%E7%94%BB" title="Tag: 动画" rel="tag">动画</a-->
        <a href="/tag/#动画" title="Tag: 动画" rel="tag">动画</a>
    
  

</span>

            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <ul id="markdown-toc">
  <li><a href="#动画效果的真实体验" id="markdown-toc-动画效果的真实体验">动画效果的真实体验</a>    <ul>
      <li><a href="#timing-function-的不足" id="markdown-toc-timing-function-的不足"><code class="language-plaintext highlighter-rouge">timing-function</code> 的不足</a></li>
      <li><a href="#弹簧-阻尼系统中的运动" id="markdown-toc-弹簧-阻尼系统中的运动">弹簧-阻尼系统中的运动</a></li>
      <li><a href="#简谐运动" id="markdown-toc-简谐运动">简谐运动</a></li>
    </ul>
  </li>
  <li><a href="#基于-react-的弹性动画库" id="markdown-toc-基于-react-的弹性动画库">基于 React 的弹性动画库</a></li>
  <li><a href="#framer-motion" id="markdown-toc-framer-motion">framer-motion</a>    <ul>
      <li><a href="#弹簧阻尼-demo" id="markdown-toc-弹簧阻尼-demo">弹簧阻尼 demo</a></li>
      <li><a href="#fadeinout-demo" id="markdown-toc-fadeinout-demo">fadeInOut demo</a></li>
      <li><a href="#drag-demo" id="markdown-toc-drag-demo">drag demo</a></li>
      <li><a href="#framer-motion-主要-api" id="markdown-toc-framer-motion-主要-api">framer-motion 主要 api</a></li>
    </ul>
  </li>
  <li><a href="#总结" id="markdown-toc-总结">总结</a></li>
</ul>

<p>前端动画的开发一直是我所热衷探索与研究的内容，本文将描述什么是拟真的动画效果，目前所流行的 React 动画库，以及一些基于 framer-motion 动画库的 demos。</p>

<h2 id="动画效果的真实体验">动画效果的真实体验</h2>

<h3 id="timing-function-的不足"><code class="language-plaintext highlighter-rouge">timing-function</code> 的不足</h3>

<p>说到拟真的的动画体验，本质是动画中的过渡动画带来的体感。通常情况开发一个前端动画，会使用 CSS transition 来实现，动画中的变量值（如 div 的位移或角度等）与时间的关系是三次贝塞尔曲线（cubic-bezier），即 <code class="language-plaintext highlighter-rouge">timing-function</code> 中常用的 <code class="language-plaintext highlighter-rouge">ease</code>, <code class="language-plaintext highlighter-rouge">ease-in</code>, <code class="language-plaintext highlighter-rouge">ease-out</code>, <code class="language-plaintext highlighter-rouge">ease-in-out</code> 等，或给三次贝塞尔曲线传入 4 个参数来控制曲线的形态。如下</p>

<p><a href="https://cubic-bezier.com/">
  <img width="70%" src="https://gw.alicdn.com/imgextra/i4/O1CN01rCo6Er1jz5h57YNjg_!!6000000004618-2-tps-978-352.png" />
</a></p>

<p><strong>但是，真实世界中，没有任何一个物体的运动是符合三次贝塞尔曲线的</strong>。因为物体的运动受到自身的质量、阻力、弹力等因素有关，这也是为什么会诞生物理引擎。接下来一步一步讲讲弹簧阻尼系统中的运动。</p>

<h3 id="弹簧-阻尼系统中的运动">弹簧-阻尼系统中的运动</h3>

<p>在很多 native 动画中，特别是 iOS 的系统动画中，可以感受到“拉动越小，回弹越小；拉动越大，回弹越大”的感受，这便是弹簧动画的效果</p>

<p><img src="https://gw.alicdn.com/imgextra/i4/O1CN01r7hDZ81Uulic8TukO_!!6000000002578-2-tps-216-139.png" alt="" /></p>

<p>首先来看弹簧的受力情况，根据胡克定律得到如下公式：</p>

\[F_s=-kX\]

<p>$k$ 为弹簧劲度系数</p>

<p>考虑到阻力，$c$ 为摩擦系数，$v$ 为速度</p>

\[F_d=-cv\]

<p>弹簧上的合力则为：</p>

\[F=F_s+F_d=-kX-cv\]

<p>再根据牛顿第二定律</p>

\[F=ma\]

<p>联立两个方程</p>

\[\begin{cases}
  F=-kX-cv \\
  F=ma
\end{cases}\]

<p>为了简单起见，我们假设质量值为 1（即 $m=1$）,这样就可以得到：</p>

\[a=-kX-cv\]

<p>$X$代表物体从其平衡位置开始移动。这就意味着，如果我们想从 $x=x$ 到 $x=1$，那么我们要每次移动 $x-1$  才能到达那个指定位置（微分的思想）。</p>

\[X=x-1\]

<p>得到运动方程</p>

\[a=-k(x-1)-cv\]

<p>接下来使用微分公式来计算出物体运动的位置和时间的关系</p>

\[x=f(t)\]

<p>根据位置计算速度</p>

\[v=\frac{dx}{dt}=f'(t)\]

<p>计算加速度</p>

\[a=\frac{dv}{dt}=f''(t)\]

<p>结合之前得出的运动方程</p>

\[\begin{cases}
  a=-k(x-1)-cv \\ \\
  a=\dfrac{dv}{dt}=f''(t) \\ \\
  v=\dfrac{dx}{dt}=f'(t) \\ \\
  x=f(t)
\end{cases}\]

<p>得出</p>

\[f''(t)=-k(f(t)-1)-cf'(t)\]

<p>接下来就是解这个微分方程了。</p>

<p>考虑一下边界条件，我们让块移动之前，块的位置假设在 $x=0$，也就是说块的初始位置是 $x=0$，初始时间是 $t=0$</p>

\[f(0)=0\]

\[f'(0)=0\]

<p>再假设劲度系数 $k=180$，摩擦系数为 $c=12$</p>

\[\begin{cases}
  f(0) = 0 \\
  f'(0) = 0 \\
  f''(t) = -180(f(t) - 1) - 12f'(t)
\end{cases}\]

<p>解方程的具体过程这里就不细讲了，而且有一个强大的搜索引擎 <a href="https://www.wolframalpha.com/input/?i=f%280%29+%3D+0%3B+f%27%280%29+%3D+0%3B+f%27%27%28t%29+%3D+-180%28f%28t%29+-+1%29+-+12f%27%28t%29">WolframAlpha</a> 可以用来解各种微积分方程，将方程用以下的方式输入</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>f(0) = 0; f'(0) = 0; f''(t) = -180(f(t) - 1) - 12f'(t)
</code></pre></div></div>

<p>如下图</p>

<p><img src="https://gw.alicdn.com/imgextra/i3/O1CN01vGtrEZ20XvfoF2xqJ_!!6000000006860-2-tps-1008-1080.png" alt="" /></p>

<p>可以看到上述截图，方程经过傅里叶变换得到</p>

\[f(t)=-\frac{1}{2}e^{-6t}(-2e^{6t}+sin(12t)+2cos(12t))\]

<p>这个函数图像在二维坐标系中绘制如下：</p>

<p><img src="https://gw.alicdn.com/imgextra/i1/O1CN01Z8zVrh1a5pMTrVSWe_!!6000000003279-2-tps-1209-605.png" alt="" /></p>

<p>是不是非常像 timing-fuction 中的三次贝塞尔曲线？是的，三次贝塞尔曲线是在模拟这个计算结果，而我们刚刚的计算真实的还原了质量为 1、劲度系数为 180、摩擦系数为 12 时的弹簧运动轨迹。</p>

<h3 id="简谐运动">简谐运动</h3>

<p>说到上述的这个运动轨迹，其本质就是一个简谐运动。这里再复习一下什么是简谐运动：</p>

<blockquote>
  <p>简谐运动，或称简谐振动、谐振、SHM（Simple Harmonic Motion），即是最基本也是最简单的一种机械振动。当某物体进行简谐运动时，物体所受的力跟位移成正比，并且力总是指向平衡位置。</p>
</blockquote>

<p>如下图，简谐运动的阻尼大小分为 4 种情况</p>

<ul>
  <li>零阻尼 (zero damping)：图中虚线为零阻尼的情况，物体将永不停歇的做周期运动</li>
  <li>欠阻尼 (light damping)：图中蓝线为欠阻尼情况，物体在平衡位置震荡，但振幅减小，最终回到平衡位置</li>
  <li>临界阻尼 (critical damping)：图中红线为临界阻尼情况，物体以最快速度回到平衡位置。现实生活中，许多大楼内房间或卫生间的门上在装备自动关门的扭转弹簧的同时，都相应地装有阻尼铰链，使得门的阻尼接近临界阻尼，这样人们关门或门被风吹动时就不会造成太大的声响，同时又能以最快速度关闭。另外汽车的避震弹簧也是使用了临界阻尼的原理</li>
  <li>过阻尼 (over damping)：图中绿线为过阻尼情况，物体以非常缓和的方式回到平衡位置</li>
</ul>

<p><img src="https://gw.alicdn.com/imgextra/i1/O1CN01K5B0EF1xUm65Kz4YF_!!6000000006447-2-tps-422-170.png" alt="" /></p>

<table>
<tr>
  <td>
    <video src="https://g.alicdn.com/ltao-fe/assets/damping.mp4" autoplay="" controls="" preload="" loop="" muted="" width="300px"></video>
  </td>
  <td>
    <a href="https://gaohaoyang.github.io/framer-motion-practice/#/Spring">点击或扫码体验</a> <br />
    <img src="https://gw.alicdn.com/imgextra/i2/O1CN011yInSb1UIIRunzpdL_!!6000000002494-2-tps-200-200.png" />
  </td>
</tr>
</table>

<p>可以看出，前文解出来的方程即一种欠阻尼的简谐运动。这些都是真实世界中的弹性运动，显然 timing-function 中的三次贝塞尔曲线无法模拟，需要一个能够模拟弹簧阻尼系统的动画库。</p>

<h2 id="基于-react-的弹性动画库">基于 React 的弹性动画库</h2>

<p>目前业内有3种基于 react 的弹性动画库，我们来分析对比一下：</p>

<ul>
  <li><a href="https://github.com/chenglou/react-motion">react-motion</a>
    <ul>
      <li>spring 动画的提出者，不支持 hooks api，3年内未更新</li>
    </ul>
  </li>
  <li><a href="https://www.react-spring.io/">react-spring</a>
    <ul>
      <li>灵感来源于 react-motion，支持 hooks，功能强大</li>
    </ul>
  </li>
  <li><a href="https://www.framer.com/motion/">framer-motion</a>
    <ul>
      <li>支持 hooks，功能强大，同时增加了很多声明式属性，api 简洁友好</li>
    </ul>
  </li>
</ul>

<p>再来对比一下3个库的 npm 下载情况，基本是差不多的</p>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>download values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>react-motion</td>
      <td><img src="https://gw.alicdn.com/imgextra/i1/O1CN01jwQeCd21tHkxwg9h1_!!6000000007042-2-tps-528-110.png" width="300px" /></td>
    </tr>
    <tr>
      <td>react-spring</td>
      <td><img src="https://gw.alicdn.com/imgextra/i1/O1CN01EZY4kL1zfswDwcpgZ_!!6000000006742-2-tps-510-114.png" width="300px" /></td>
    </tr>
    <tr>
      <td>framer-motion</td>
      <td><img src="https://gw.alicdn.com/imgextra/i4/O1CN01RsV09s1abQgessyq0_!!6000000003348-2-tps-526-114.png" width="300px" /></td>
    </tr>
  </tbody>
</table>

<p>其中 framer-motion 可以说是异军突起，发展非常迅猛</p>

<p><img src="https://gw.alicdn.com/imgextra/i1/O1CN01SWjSmq1yf8fnymlCS_!!6000000006605-2-tps-364-175.png" alt="" /></p>

<p><img src="https://gw.alicdn.com/imgextra/i3/O1CN017jtfSs1mRbaCrPZGb_!!6000000004951-2-tps-397-199.png" alt="" /></p>

<p>2020年10月的周下载量几乎是2019年同期的10倍，这大部分得益于其 api 的友好性。接下来将一起探索一下 framer-motion 的使用方式。</p>

<h2 id="framer-motion">framer-motion</h2>

<p>什么是 framer-motion？先看下官网<a href="https://www.framer.com/motion/">https://www.framer.com/motion/</a>的一段话</p>

<blockquote>
  <p>A production-ready motion library for React. Utilize the power behind Framer, the best prototyping tool for teams. Proudly open source.</p>
</blockquote>

<p>framer motion 是一个生产级的 React 动画库，为他们自家原型工具产品 Framer 提供了支持，并自豪的进行了开源。事实上，framer motion 作为动画库，提供了一些极其简洁的 api 帮助我们创建复杂的动效，这些 api 帮助然我们抽象出动画背后的复杂性，让创建动画变得简单。</p>

<p>官网强调了几个特性，这也是其极简 api 的一些特性</p>

<ul>
  <li>声明式api</li>
  <li>组件间共享布局动画</li>
  <li>手势支持</li>
</ul>

<p>接下来看一些我开发的 demo 吧，上述的弹簧阻尼特性就是使用了 framer-motion 进行开发</p>

<h3 id="弹簧阻尼-demo">弹簧阻尼 demo</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">motion</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">framer-motion</span><span class="dl">'</span>

<span class="k">import</span> <span class="dl">'</span><span class="s1">./index.css</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nf">index</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">return </span><span class="p">(</span>
    <span class="p">&lt;&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"wrap"</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"title"</span><span class="p">&gt;</span>零阻尼<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">motion</span><span class="p">.</span><span class="nt">div</span>
          <span class="na">className</span><span class="p">=</span><span class="s">"ball"</span>
          <span class="na">animate</span><span class="p">=</span><span class="si">{</span><span class="p">{</span>
            <span class="na">x</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
            <span class="na">transition</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">spring</span><span class="dl">'</span><span class="p">,</span>
              <span class="na">damping</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">},</span>
          <span class="p">}</span><span class="si">}</span>
        <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"wrap"</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"title"</span><span class="p">&gt;</span>欠阻尼<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">motion</span><span class="p">.</span><span class="nt">div</span>
          <span class="na">className</span><span class="p">=</span><span class="s">"ball"</span>
          <span class="na">animate</span><span class="p">=</span><span class="si">{</span><span class="p">{</span>
            <span class="na">x</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
            <span class="na">transition</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">spring</span><span class="dl">'</span><span class="p">,</span>
              <span class="na">damping</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">},</span>
          <span class="p">}</span><span class="si">}</span>
        <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"wrap"</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"title"</span><span class="p">&gt;</span>过阻尼<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">motion</span><span class="p">.</span><span class="nt">div</span>
          <span class="na">className</span><span class="p">=</span><span class="s">"ball"</span>
          <span class="na">animate</span><span class="p">=</span><span class="si">{</span><span class="p">{</span>
            <span class="na">x</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
            <span class="na">transition</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">spring</span><span class="dl">'</span><span class="p">,</span>
              <span class="na">damping</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
            <span class="p">},</span>
          <span class="p">}</span><span class="si">}</span>
        <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"wrap"</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"title"</span><span class="p">&gt;</span>临界阻尼<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">motion</span><span class="p">.</span><span class="nt">div</span>
          <span class="na">className</span><span class="p">=</span><span class="s">"ball"</span>
          <span class="na">animate</span><span class="p">=</span><span class="si">{</span><span class="p">{</span>
            <span class="na">x</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
            <span class="na">transition</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">spring</span><span class="dl">'</span><span class="p">,</span>
              <span class="na">damping</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
            <span class="p">},</span>
          <span class="p">}</span><span class="si">}</span>
        <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

      <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span>
        <span class="na">type</span><span class="p">=</span><span class="s">"button"</span>
        <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nf">reload</span><span class="p">()</span>
        <span class="p">}</span><span class="si">}</span>
      <span class="p">&gt;</span>
        reload this page
      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">index</span>
</code></pre></div></div>

<p>demo 页面链接 <a href="https://gaohaoyang.github.io/framer-motion-practice/#/Spring">https://gaohaoyang.github.io/framer-motion-practice/#/Spring</a></p>

<p>可以看到代码确实非常简洁。本质上代码分为两部分：</p>
<ul>
  <li>motion 为前缀的 HTML 或 SVG 标签结合在一起创建的基础组件</li>
  <li>通过 prop 与组件对接的 api</li>
</ul>

<p>代码中修改位移、阻尼的地方如下，代码中只设置了 div 需要运动的位移 x，和阻尼值（质量和劲度系数使用默认值），就完成了动画的触发。这是与传统的 transition 设置 duration 等值的动画理念完全不同。</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">animate</span><span class="o">=</span><span class="p">{{</span>
  <span class="na">x</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
  <span class="na">transition</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">spring</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// 弹簧动画</span>
    <span class="na">damping</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c1">// 阻尼值</span>
  <span class="p">},</span>
<span class="p">}}</span>
</code></pre></div></div>

<p>再看下页面渲染时的标签上的属性变化</p>

<video src="https://g.alicdn.com/ltao-fe/assets/damping_render.mp4" autoplay="" controls="" preload="" loop="" muted="" width="100%"></video>

<p>可以看到每一帧 <code class="language-plaintext highlighter-rouge">translateX</code> 的值在发生变化，同时 framer-motion 出于性能的考虑，又增加了 <code class="language-plaintext highlighter-rouge">translateZ(0px)</code> 这个属性。</p>

<h3 id="fadeinout-demo">fadeInOut demo</h3>

<p>接下来再看一个元素展示和隐藏时的动画 demo。正常情况下，在元素消失时，我们要监听 <code class="language-plaintext highlighter-rouge">transitionend</code> 事件，然后再移除 dom 节点，但 framer-motion 也帮我们封装好了，只需要 <code class="language-plaintext highlighter-rouge">AnimatePresence</code> 这个标签即可，代码如下：</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">motion</span><span class="p">,</span> <span class="nx">AnimatePresence</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">framer-motion</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nf">index</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">toggleShow</span><span class="p">,</span> <span class="nx">setToggleShow</span><span class="p">]</span> <span class="o">=</span> <span class="nf">useState</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
  <span class="nf">return </span><span class="p">(</span>
    <span class="p">&lt;&gt;</span>
      <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span>
        <span class="na">onClick</span><span class="p">=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nf">setToggleShow</span><span class="p">((</span><span class="nx">pre</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">pre</span><span class="p">)</span>
        <span class="p">}</span><span class="si">}</span>
        <span class="na">type</span><span class="p">=</span><span class="s">"button"</span>
      <span class="p">&gt;</span>
        toggleShow
      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>

      <span class="p">&lt;</span><span class="nc">AnimatePresence</span><span class="p">&gt;</span>
        <span class="si">{</span><span class="nx">toggleShow</span> <span class="o">&amp;&amp;</span> <span class="p">(</span>
          <span class="p">&lt;</span><span class="nt">motion</span><span class="p">.</span><span class="nt">div</span>
            <span class="na">style</span><span class="p">=</span><span class="si">{</span><span class="p">{</span>
              <span class="na">backgroundColor</span><span class="p">:</span> <span class="dl">'</span><span class="s1">#ddd</span><span class="dl">'</span><span class="p">,</span>
              <span class="na">width</span><span class="p">:</span> <span class="dl">'</span><span class="s1">50vw</span><span class="dl">'</span><span class="p">,</span>
              <span class="na">height</span><span class="p">:</span> <span class="dl">'</span><span class="s1">80vw</span><span class="dl">'</span><span class="p">,</span>
            <span class="p">}</span><span class="si">}</span>
            <span class="na">key</span><span class="p">=</span><span class="s">"modal"</span>
            <span class="na">initial</span><span class="p">=</span><span class="si">{</span><span class="p">{</span> <span class="na">opacity</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}</span><span class="si">}</span>
            <span class="na">animate</span><span class="p">=</span><span class="si">{</span><span class="p">{</span> <span class="na">opacity</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">x</span><span class="p">:</span> <span class="mi">100</span> <span class="p">}</span><span class="si">}</span>
            <span class="na">exit</span><span class="p">=</span><span class="si">{</span><span class="p">{</span> <span class="na">opacity</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">x</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}</span><span class="si">}</span>
          <span class="p">&gt;</span>
            fadeInOut animation
          <span class="p">&lt;/</span><span class="nt">motion</span><span class="p">.</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">)</span><span class="si">}</span>
      <span class="p">&lt;/</span><span class="nc">AnimatePresence</span><span class="p">&gt;</span>
    <span class="p">&lt;/&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">index</span>
</code></pre></div></div>

<table>
<tr>
  <td>
    <video src="https://g.alicdn.com/ltao-fe/assets/fadeInOut.mp4" autoplay="" controls="" preload="" loop="" muted="" width="300px"></video>
  </td>
  <td>
    <a href="https://gaohaoyang.github.io/framer-motion-practice/#/FadeInOut">点击或扫码体验</a> <br />
    <img src="https://gw.alicdn.com/imgextra/i1/O1CN01zm3ZKY1x4D7uLkixa_!!6000000006389-2-tps-200-200.png" />
  </td>
</tr>
</table>

<p>代码中，我们可以看到使用 useState 设置了 div 展示或隐藏的状态。在需要有移除操作的动效中，使用 <code class="language-plaintext highlighter-rouge">AnimatePresence</code> 标签包裹，设置 exit 属性就好了</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">exit</span><span class="o">=</span><span class="p">{{</span> <span class="na">opacity</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">x</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}}</span>
</code></pre></div></div>

<p>再看下页面渲染时的标签的变化</p>

<video src="https://g.alicdn.com/ltao-fe/assets/fadeInOut_render.mp4" autoplay="" controls="" preload="" loop="" muted="" width="100%"></video>

<p>点击 toggle 按钮时，先执行动画再进行了 dom 移除操作。</p>

<h3 id="drag-demo">drag demo</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">motion</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">framer-motion</span><span class="dl">'</span>
<span class="k">import</span> <span class="dl">'</span><span class="s1">./index.css</span><span class="dl">'</span>

<span class="kd">function</span> <span class="nf">index</span><span class="p">()</span> <span class="p">{</span>
  <span class="nf">return </span><span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="p">=</span><span class="s">"container"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span>
        <span class="na">className</span><span class="p">=</span><span class="s">"box"</span>
        <span class="na">style</span><span class="p">=</span><span class="si">{</span><span class="p">{</span>
          <span class="na">width</span><span class="p">:</span> <span class="dl">'</span><span class="s1">300px</span><span class="dl">'</span><span class="p">,</span>
          <span class="na">height</span><span class="p">:</span> <span class="dl">'</span><span class="s1">500px</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">}</span><span class="si">}</span>
      <span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">motion</span><span class="p">.</span><span class="nt">div</span>
          <span class="na">style</span><span class="p">=</span><span class="si">{</span><span class="p">{</span> <span class="na">width</span><span class="p">:</span> <span class="dl">'</span><span class="s1">44px</span><span class="dl">'</span><span class="p">,</span> <span class="na">height</span><span class="p">:</span> <span class="dl">'</span><span class="s1">44px</span><span class="dl">'</span> <span class="p">}</span><span class="si">}</span>
          <span class="na">className</span><span class="p">=</span><span class="s">"ball"</span>
          <span class="na">drag</span>
          <span class="na">dragConstraints</span><span class="p">=</span><span class="si">{</span><span class="p">{</span>
            <span class="na">top</span><span class="p">:</span> <span class="o">-</span><span class="mi">228</span><span class="p">,</span>
            <span class="na">bottom</span><span class="p">:</span> <span class="mi">228</span><span class="p">,</span>
            <span class="na">left</span><span class="p">:</span> <span class="o">-</span><span class="mi">128</span><span class="p">,</span>
            <span class="na">right</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
          <span class="p">}</span><span class="si">}</span>
          <span class="na">dragElastic</span><span class="p">=</span><span class="si">{</span><span class="mf">0.2</span><span class="si">}</span>
        <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">index</span>
</code></pre></div></div>

<p>效果如下：</p>

<table>
<tr>
  <td>
    <video src="https://g.alicdn.com/ltao-fe/assets/drag.mp4" autoplay="" controls="" preload="" loop="" muted="" width="300px"></video>
  </td>
  <td>
    <a href="https://gaohaoyang.github.io/framer-motion-practice/#/DragBall">点击或扫码体验</a> <br />
    <img src="https://gw.alicdn.com/imgextra/i3/O1CN01WRs9RF1MjIsVUyAcm_!!6000000001470-2-tps-200-200.png" />
  </td>
</tr>
</table>

<p>可以看到代码非常简单，给 div 设置 drag 属性、dragElastic 弹性、drag 边界条件，即可得到这样的效果，并且在 drag 过程中松手时，div 会随着惯性继续移动。</p>

<p>同样在浏览器中渲染时，出于性能优化的考虑，framer-motion 使用了 translate3d() 来开启 GPU 加速。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>transform: translate3d(128px, 228px, 0px);
</code></pre></div></div>

<p>其他更多 demo 请访问 <a href="https://gaohaoyang.github.io/framer-motion-practice/">https://gaohaoyang.github.io/framer-motion-practice/</a></p>

<p>或扫码：</p>

<p><img src="https://gw.alicdn.com/imgextra/i2/O1CN01i01FKn1XJcRQhnuKc_!!6000000002903-2-tps-200-200.png" alt="" /></p>

<p>demo 的 git 地址：<a href="https://github.com/Gaohaoyang/framer-motion-practice">https://github.com/Gaohaoyang/framer-motion-practice</a></p>

<h3 id="framer-motion-主要-api">framer-motion 主要 api</h3>

<p>framer-motion 不止拥有 spring 动画，同样也具有 tween 补间动画，keyframes 动画，同时还提供了动画编排、丰富的手势、各种 hooks api，详情可以参考官网文档 <a href="https://www.framer.com/api/motion/">https://www.framer.com/api/motion/</a></p>

<p><img src="https://gw.alicdn.com/imgextra/i4/O1CN01zqTgCa1nV6DfcZSCu_!!6000000005094-2-tps-1572-996.png" alt="" /></p>

<h2 id="总结">总结</h2>

<p>不同复杂度的动画可以使用不同的动画库。对于拟真的大面积布局/dom/svg react/rax动画可以考虑使用 framer-motion。framer-motion 具有极其简洁的 api，并支持了 spring 弹性动画，手势拖拽，hooks api 等。</p>

<p>这些是物理和数学的魅力，感谢伟大的科学先驱们：</p>

<p><img src="https://gw.alicdn.com/imgextra/i3/O1CN01iN0CRO1I7y83KjN6g_!!6000000000847-2-tps-1758-634.png" alt="" /></p>


        </article>
        <hr>

        
        
            
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
        
            
            
                
                    
                
            
                
                    
                
            
        
        

        <div class="post-recent">
    <div class="pre">
        
        <p><strong>上一篇</strong> <a href="/2020/05/27/react-hooks8-customHooks/">React Hooks 系列之8 custom Hook</a></p>
        
    </div>
    <div class="nex">

        
        <p><strong>下一篇</strong> <a href="/2021/07/13/tri-in-animation/">动画中的三角学</a></p>
        
    </div>
</div>


        <h2 id="comments">Comments</h2>
        


<div id="disqus_thread"></div>
<script>
    /**
     * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function() {
        this.page.url = 'http://localhost:4000/2021/03/01/spring-animation-framer-motion/'; // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://localhost:4000/2021/03/01/spring-animation-framer-motion/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };

    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document,
            s = d.createElement('script');

        s.src = '//gaohaoyang.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>




    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <!-- <div class="side">bbbb</div> -->
        </div>
    </div>
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
             本站记录我前端之旅的沿途风景！ 
        </p>
        <p class="contact">
            Contact me at: 
            <a href="https://github.com/Gaohaoyang" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>  
            <a href="mailto:gaohaoyang126@126.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>  
            <a href="http://weibo.com/3115521wh" title="Weibo"><i class="fa fa-weibo" aria-hidden="true"></i></a>  
            <a href="https://www.zhihu.com/people/gaohaoyang" title="Zhihu"><i class="iconfont icon-daoruzhihu"></i></a>   
            <a href="https://www.facebook.com/gaohaoyang.water" title="Facebook"><i class="fa fa-facebook-official" aria-hidden="true"></i></a>   
            <a href="https://www.linkedin.com/in/gaohaoyang" title="LinkedIn"><i class="fa fa-linkedin" aria-hidden="true"></i></a>  
        </p>
        <p>
            本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
            <span>
                Theme designed by <a href="https://github.com/Gaohaoyang">HyG</a>.
            </span>
        </p>
    </div>
</footer>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/smooth-scroll.min.js " charset="utf-8"></script>
    <script type="text/javascript">
      smoothScroll.init({
        speed: 500, // Integer. How fast to complete the scroll in milliseconds
        easing: 'easeInOutCubic', // Easing pattern to use
        offset: 20, // Integer. How far to offset the scrolling anchor location in pixels
      });
    </script>
    <!-- <script src=" /js/scroll.min.js " charset="utf-8"></script> -->
  </body>

</html>
