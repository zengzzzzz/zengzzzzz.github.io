---
layout: post
title:  "不同主机之间数据包的传输过程"
date:   2021-03-29 21:57:00
categories: 
tags:  zengzzzzz-blog
---

* content
{:toc}

同一广播域内，两台主机通信过程  
&nbsp; 主机进行通信传送数据时，将应用数据封装成IP包，数据链路层封装成帧，根据MAC地址，发送数据  
  
N0与N1进行通信，N0知道N1的IP地址，不知MAC地址，N0发送ARP广播请求给同一广播域中的所有成员  
当SWO从主机的接口上接收到这个广播包，读取帧源的MAC地址和目标MAC地址，将NO的MAC地址与之相对应的接口放入MAC地址表，从别的接口广播这个数据帧  
当别的主机收到这个广播时，查看目标IP不是自己的，就会丢弃此包。如果N1接收到这个数据帧，它检查目标IP和这个的IP是一样的，就会回应这个ARP请求，把自己的IP和MAC封装成源IP和源MAC，N0的IP和N0的MAC地址为目标IP与目标MAC，并记录NO的MAC与IP，放进自己的ARP缓存表中  
这个应答包经过交换机SWO时，它又会检查源MAC&nbsp;、 目标MAC，把N1的MAC和自己接口2放进MAC地址表中，再查看自己的MAC地址表，发现存在目标MAC与自己的1接口对应（由于刚开始有记录过N0的MAC），那它就会直接把这个应答包从接口1送出去了  
主机N0收到这个包后发现目标MAC是自己，就会处理这个包。并把N1的MAC与IP放进自己的ARP缓存表中。这时主机N0就知道N1的MAC地址了，以后要发送数据，就直接把N1的IP与MAC封装进帧中进行点对点的发送  
  
跨路由的数据传输过程  
  
当NO要和N2通信时，此时NO会检查N2的IP地址跟自己是否处在同一网段，两主机肯定不会是同一网段的  
N2和自己处在不同网段，所以，N0会把数据包发给它的网关，也就是R0上的F0/0接口，源IP和源MAC地址是N0自己的，目标IP是N2的，目标MAC是R0上接口F0/0的（如果N0不知道F0/0的MAC,就会跟情景一相似，发个ARP广播来得到F0/0的MAC地址）  
当这个数据包到达R0时，路由器R0会查看目标IP的是否是自己，由于目标不是自己，就会查看自己的路由表，找出到达N2网段的路由；如果没有相关条目，就直接丢弃。当查看路由表后发现到达N2网段的出接口是F0/1，把数据包转到F0/1接口上，再由接口F0/1传给R1。这个过程，数据包的源IP是N0 源MAC是F0/1 目标IP是N2 目标MAC是R1的F0/1接口IP&nbsp;  
&nbsp;当R1收到这个数据包后，同样也要检查包的目标IP是否是自己，它会主动查找自己的路由表，发现目标IP跟自己F0/0接口处在同一网段，于是就把包传到F0/0接口上去发给N2&nbsp;  
假如R1上的ARP缓存表中没有N2的MAC，则接口F0/0会发送一个ARP广播给跟它相连的广播域中；这个ARP广播包的源IP是接口F0/0的IP 源MAC也是F0/0的MAC&nbsp; 目标IP是N2 目标MAC为N2的F0/1,假如N2的MAC地址已经在R1的ARP缓存中了，那就会直接把数据包封装成：源IP为N0 源MAC为R1的F0/0 目标IP为N2 目标MAC为N2了  
同一广播域中，包的源、目标IP;源、目标MAC是真实的两台主机上的IP与MAC地址  
  
&nbsp;  
跨路由中，包的源IP与目标IP始终不会发生变化，源和目标MAC根据所经过的路由接口不同而发生相应变化  
  

